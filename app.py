import streamlit as st
import json
import os

# --- ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ ---
st.set_page_config(page_title="ูุธุงู ุฅุฏุงุฑุฉ ุงูุจุญุซ ุงูุนููู", layout="wide", page_icon="๐")

# --- ููู ุชุฎุฒูู ุงูุจูุงูุงุช ---
DB_FILE = "research_data.json"

# --- ููููุฉ ุงูุจุญุซ (ููุง ุทูุจุช ุจุงูุชูุตูู) ---
RESEARCH_STRUCTURE = {
    "1. ุงูุตูุญุงุช ุงูุชูููุฏูุฉ": [
        "ุตูุญุฉ ุงูุบูุงู (ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ)",
        "ุตูุญุฉ ุงูุชูุฏูู ูุงูุดูุฑ",
        "ููุงุญุธุงุช ุงูููุฑุณ"
    ],
    "2. ุงููุตู ุงูุฃูู: ุฎุทุฉ ุงูุจุญุซ": [
        "1- ุงูููุฏูุฉ",
        "2- ูุดููุฉ ุงูุฏุฑุงุณุฉ ูุชุณุงุคูุงุชูุง",
        "3- ุฃูููุฉ ุงูุฏุฑุงุณุฉ",
        "4- ุฃูุฏุงู ุงูุฏุฑุงุณุฉ",
        "5- ุญุฏูุฏ ุงูุฏุฑุงุณุฉ",
        "6- ุฅุฌุฑุงุกุงุช ุงูุฏุฑุงุณุฉ",
        "7- ุงููุตุทูุญุงุช"
    ],
    "3. ุงููุตู ุงูุซุงูู: ุงูุฅุทุงุฑ ุงููุธุฑู": [
        "ุงููุญูุฑ ุงูุฃูู",
        "ุงููุญูุฑ ุงูุซุงูู",
        "ุงููุญูุฑ ุงูุซุงูุซ",
        "ุงููุญูุฑ ุงูุฑุงุจุน (ุฅู ูุฌุฏ)",
        "ุงููุญูุฑ ุงูุฎุงูุณ (ุฅู ูุฌุฏ)"
    ],
    "4. ุงููุตู ุงูุซุงูุซ: ุงูุฏุฑุงุณุงุช ุงูุณุงุจูุฉ": [
        "ุงูุฏุฑุงุณุงุช ุงูุณุงุจูุฉ (ุนุฑุถ ุงูุฏุฑุงุณุงุช)",
        "ููุงูุดุฉ ุงูุฏุฑุงุณุงุช ุงูุณุงุจูุฉ (ุงูุชุนููุจ)"
    ],
    "5. ุงููุตู ุงูุฑุงุจุน: ูููุฌูุฉ ุงูุฏุฑุงุณุฉ": [
        "1- ูููุฌ ุงูุฏุฑุงุณุฉ",
        "2- ูุฌุชูุน ุงูุฏุฑุงุณุฉ",
        "3- ุนููุฉ ุงูุฏุฑุงุณุฉ ูุทุฑู ุงุฎุชูุงุฑูุง",
        "4- ุฃุฏุงุฉ ุงูุฏุฑุงุณุฉ ูุทุฑู ุจูุงุฆูุง",
        "5- ุตุฏู ุฃุฏุงุฉ ุงูุฏุฑุงุณุฉ",
        "6- ุซุจุงุช ุฃุฏุงุฉ ุงูุฏุฑุงุณุฉ"
    ],
    "6. ุงููุตู ุงูุฎุงูุณ: ุงููุชุงุฆุฌ ูุชุญููููุง": [
        "1- ุงุณุชุนุฑุงุถ ูุชุงุฆุฌ ุงูุฏุฑุงุณุฉ",
        "2- ุชูุณูุฑ ุงููุชุงุฆุฌ",
        "3- ููุงูุดุฉ ุงูุฃุณุฆูุฉ/ุงููุฑุถูุงุช"
    ],
    "7. ุงููุตู ุงูุณุงุฏุณ: ุงูุฎุงุชูุฉ": [
        "1- ุฎูุงุตุฉ ุงูุฏุฑุงุณุฉ",
        "2- ุฎูุงุตุฉ ุงููุชุงุฆุฌ",
        "3- ุฏุฑุงุณุงุช ูุจุญูุซ ููุชุฑุญุฉ"
    ],
    "8. ุงููุฑุงุฌุน ูุงูููุงุญู": [
        "ุงููุฑุงุฌุน ุงูุนุฑุจูุฉ",
        "ุงููุฑุงุฌุน ุงูุฃุฌูุจูุฉ",
        "ุงูููุงุญู",
        "ูุงุฆูุฉ ุงูุฌุฏุงูู"
    ]
}

# --- ุฏูุงู ุงููุณุงุนุฏุฉ ---
def load_data():
    if not os.path.exists(DB_FILE):
        return {}
    with open(DB_FILE, "r", encoding="utf-8") as f:
        return json.load(f)

def save_data(data):
    with open(DB_FILE, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=4)

# --- ุงูุชุญูู ูู ุงูุฏุฎูู ---
def check_login():
    if "logged_in" not in st.session_state:
        st.session_state.logged_in = False

    if not st.session_state.logged_in:
        col1, col2, col3 = st.columns([1,2,1])
        with col2:
            st.title("๐ ุจูุงุจุฉ ุฏุฎูู ุงูุจุงุญุซ")
            username = st.text_input("ุงุณู ุงููุณุชุฎุฏู")
            password = st.text_input("ูููุฉ ุงููุฑูุฑ", type="password")
            if st.button("ุชุณุฌูู ุงูุฏุฎูู", use_container_width=True):
                if username == "101010" and password == "123321":
                    st.session_state.logged_in = True
                    st.rerun()
                else:
                    st.error("ุจูุงูุงุช ุงูุฏุฎูู ุบูุฑ ุตุญูุญุฉ")
        return False
    return True

# --- ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ ---
def main_app():
    # ุชุญููู ุงูุจูุงูุงุช ุงููุญููุธุฉ
    saved_data = load_data()
    
    # ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
    with st.sidebar:
        st.title("๐๏ธ ุฃูุณุงู ุงูุจุญุซ")
        selected_chapter = st.radio("ุงูุชูู ุฅูู:", list(RESEARCH_STRUCTURE.keys()))
        
        st.markdown("---")
        if st.button("ุชุณุฌูู ุฎุฑูุฌ"):
            st.session_state.logged_in = False
            st.rerun()

    # ููุทูุฉ ุงูุนุฑุถ ุงูุฑุฆูุณูุฉ
    st.header(f"๐ {selected_chapter}")
    st.markdown("---")

    # ุฌูุจ ุงูุญููู ุงููุฑุนูุฉ ููุฐุง ุงููุตู
    sub_sections = RESEARCH_STRUCTURE[selected_chapter]

    # ุฅูุดุงุก ูููุฐุฌ (Form) ููุญูุธ
    with st.form(key="research_form"):
        current_inputs = {}
        
        for sub in sub_sections:
            # ููุชุงุญ ูุฑูุฏ ููู ุญูู ูุถูุงู ุนุฏู ุชุฏุงุฎู ุงูุจูุงูุงุช
            field_key = f"{selected_chapter}_{sub}"
            
            # ุงุณุชุฑุฌุงุน ุงููููุฉ ุงููุฏููุฉ ุฅู ูุฌุฏุช
            default_val = saved_data.get(field_key, "")
            
            st.subheader(sub)
            user_input = st.text_area(f"ุงูุชุจ ูุญุชูู ({sub}) ููุง:", value=default_val, height=200)
            current_inputs[field_key] = user_input
            st.markdown("<br>", unsafe_allow_html=True)

        # ุฒุฑ ุงูุญูุธ
        submit_btn = st.form_submit_button("๐พ ุญูุธ ุงูุชุนุฏููุงุช ุนูู ุงูุณุญุงุจุฉ", use_container_width=True)

        if submit_btn:
            # ุชุญุฏูุซ ุงูุจูุงูุงุช
            saved_data.update(current_inputs)
            save_data(saved_data)
            st.success("โ ุชู ุญูุธ ุงูุจูุงูุงุช ุจูุฌุงุญ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช!")

# --- ุชุดุบูู ุงูุชุทุจูู ---
if check_login():
    main_app()
